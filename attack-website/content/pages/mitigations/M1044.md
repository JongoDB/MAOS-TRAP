Title: Restrict Library Loading-enterprise
Template: mitigations/mitigation
save_as: mitigations/M1044/index.html
data: {"attack_id": "M1044", "domain": "enterprise", "side_menu_data": {"name": "mitigations", "id": "mitigations", "path": null, "children": [{"name": "Enterprise", "id": "enterprise", "path": "/mitigations/enterprise/", "children": [{"name": "Account Use Policies", "id": "Account Use Policies", "path": "/mitigations/M1036/", "children": []}, {"name": "Active Directory Configuration", "id": "Active Directory Configuration", "path": "/mitigations/M1015/", "children": []}, {"name": "Antivirus/Antimalware", "id": "Antivirus/Antimalware", "path": "/mitigations/M1049/", "children": []}, {"name": "Application Developer Guidance", "id": "Application Developer Guidance", "path": "/mitigations/M1013/", "children": []}, {"name": "Application Isolation and Sandboxing", "id": "Application Isolation and Sandboxing", "path": "/mitigations/M1048/", "children": []}, {"name": "Audit", "id": "Audit", "path": "/mitigations/M1047/", "children": []}, {"name": "Behavior Prevention on Endpoint", "id": "Behavior Prevention on Endpoint", "path": "/mitigations/M1040/", "children": []}, {"name": "Boot Integrity", "id": "Boot Integrity", "path": "/mitigations/M1046/", "children": []}, {"name": "Code Signing", "id": "Code Signing", "path": "/mitigations/M1045/", "children": []}, {"name": "Credential Access Protection", "id": "Credential Access Protection", "path": "/mitigations/M1043/", "children": []}, {"name": "Data Backup", "id": "Data Backup", "path": "/mitigations/M1053/", "children": []}, {"name": "Data Loss Prevention", "id": "Data Loss Prevention", "path": "/mitigations/M1057/", "children": []}, {"name": "Disable or Remove Feature or Program", "id": "Disable or Remove Feature or Program", "path": "/mitigations/M1042/", "children": []}, {"name": "Do Not Mitigate", "id": "Do Not Mitigate", "path": "/mitigations/M1055/", "children": []}, {"name": "Encrypt Sensitive Information", "id": "Encrypt Sensitive Information", "path": "/mitigations/M1041/", "children": []}, {"name": "Environment Variable Permissions", "id": "Environment Variable Permissions", "path": "/mitigations/M1039/", "children": []}, {"name": "Execution Prevention", "id": "Execution Prevention", "path": "/mitigations/M1038/", "children": []}, {"name": "Exploit Protection", "id": "Exploit Protection", "path": "/mitigations/M1050/", "children": []}, {"name": "Filter Network Traffic", "id": "Filter Network Traffic", "path": "/mitigations/M1037/", "children": []}, {"name": "Limit Access to Resource Over Network", "id": "Limit Access to Resource Over Network", "path": "/mitigations/M1035/", "children": []}, {"name": "Limit Hardware Installation", "id": "Limit Hardware Installation", "path": "/mitigations/M1034/", "children": []}, {"name": "Limit Software Installation", "id": "Limit Software Installation", "path": "/mitigations/M1033/", "children": []}, {"name": "Multi-factor Authentication", "id": "Multi-factor Authentication", "path": "/mitigations/M1032/", "children": []}, {"name": "Network Intrusion Prevention", "id": "Network Intrusion Prevention", "path": "/mitigations/M1031/", "children": []}, {"name": "Network Segmentation", "id": "Network Segmentation", "path": "/mitigations/M1030/", "children": []}, {"name": "Operating System Configuration", "id": "Operating System Configuration", "path": "/mitigations/M1028/", "children": []}, {"name": "Out-of-Band Communications Channel", "id": "Out-of-Band Communications Channel", "path": "/mitigations/M1060/", "children": []}, {"name": "Password Policies", "id": "Password Policies", "path": "/mitigations/M1027/", "children": []}, {"name": "Pre-compromise", "id": "Pre-compromise", "path": "/mitigations/M1056/", "children": []}, {"name": "Privileged Account Management", "id": "Privileged Account Management", "path": "/mitigations/M1026/", "children": []}, {"name": "Privileged Process Integrity", "id": "Privileged Process Integrity", "path": "/mitigations/M1025/", "children": []}, {"name": "Remote Data Storage", "id": "Remote Data Storage", "path": "/mitigations/M1029/", "children": []}, {"name": "Restrict File and Directory Permissions", "id": "Restrict File and Directory Permissions", "path": "/mitigations/M1022/", "children": []}, {"name": "Restrict Library Loading", "id": "Restrict Library Loading", "path": "/mitigations/M1044/", "children": []}, {"name": "Restrict Registry Permissions", "id": "Restrict Registry Permissions", "path": "/mitigations/M1024/", "children": []}, {"name": "Restrict Web-Based Content", "id": "Restrict Web-Based Content", "path": "/mitigations/M1021/", "children": []}, {"name": "Software Configuration", "id": "Software Configuration", "path": "/mitigations/M1054/", "children": []}, {"name": "SSL/TLS Inspection", "id": "SSL/TLS Inspection", "path": "/mitigations/M1020/", "children": []}, {"name": "Threat Intelligence Program", "id": "Threat Intelligence Program", "path": "/mitigations/M1019/", "children": []}, {"name": "Update Software", "id": "Update Software", "path": "/mitigations/M1051/", "children": []}, {"name": "User Account Control", "id": "User Account Control", "path": "/mitigations/M1052/", "children": []}, {"name": "User Account Management", "id": "User Account Management", "path": "/mitigations/M1018/", "children": []}, {"name": "User Training", "id": "User Training", "path": "/mitigations/M1017/", "children": []}, {"name": "Vulnerability Scanning", "id": "Vulnerability Scanning", "path": "/mitigations/M1016/", "children": []}]}, {"name": "Mobile", "id": "mobile", "path": "/mitigations/mobile/", "children": [{"name": "Antivirus/Antimalware", "id": "Antivirus/Antimalware", "path": "/mitigations/M1058/", "children": []}, {"name": "Application Developer Guidance", "id": "Application Developer Guidance", "path": "/mitigations/M1013/", "children": []}, {"name": "Attestation", "id": "Attestation", "path": "/mitigations/M1002/", "children": []}, {"name": "Deploy Compromised Device Detection Method", "id": "Deploy Compromised Device Detection Method", "path": "/mitigations/M1010/", "children": []}, {"name": "Do Not Mitigate", "id": "Do Not Mitigate", "path": "/mitigations/M1059/", "children": []}, {"name": "Encrypt Network Traffic", "id": "Encrypt Network Traffic", "path": "/mitigations/M1009/", "children": []}, {"name": "Enterprise Policy", "id": "Enterprise Policy", "path": "/mitigations/M1012/", "children": []}, {"name": "Interconnection Filtering", "id": "Interconnection Filtering", "path": "/mitigations/M1014/", "children": []}, {"name": "Lock Bootloader", "id": "Lock Bootloader", "path": "/mitigations/M1003/", "children": []}, {"name": "Security Updates", "id": "Security Updates", "path": "/mitigations/M1001/", "children": []}, {"name": "System Partition Integrity", "id": "System Partition Integrity", "path": "/mitigations/M1004/", "children": []}, {"name": "Use Recent OS Version", "id": "Use Recent OS Version", "path": "/mitigations/M1006/", "children": []}, {"name": "User Guidance", "id": "User Guidance", "path": "/mitigations/M1011/", "children": []}]}, {"name": "ICS", "id": "ics", "path": "/mitigations/ics/", "children": [{"name": "Access Management", "id": "Access Management", "path": "/mitigations/M0801/", "children": []}, {"name": "Account Use Policies", "id": "Account Use Policies", "path": "/mitigations/M0936/", "children": []}, {"name": "Active Directory Configuration", "id": "Active Directory Configuration", "path": "/mitigations/M0915/", "children": []}, {"name": "Antivirus/Antimalware", "id": "Antivirus/Antimalware", "path": "/mitigations/M0949/", "children": []}, {"name": "Application Developer Guidance", "id": "Application Developer Guidance", "path": "/mitigations/M0913/", "children": []}, {"name": "Application Isolation and Sandboxing", "id": "Application Isolation and Sandboxing", "path": "/mitigations/M0948/", "children": []}, {"name": "Audit", "id": "Audit", "path": "/mitigations/M0947/", "children": []}, {"name": "Authorization Enforcement", "id": "Authorization Enforcement", "path": "/mitigations/M0800/", "children": []}, {"name": "Boot Integrity", "id": "Boot Integrity", "path": "/mitigations/M0946/", "children": []}, {"name": "Code Signing", "id": "Code Signing", "path": "/mitigations/M0945/", "children": []}, {"name": "Communication Authenticity", "id": "Communication Authenticity", "path": "/mitigations/M0802/", "children": []}, {"name": "Data Backup", "id": "Data Backup", "path": "/mitigations/M0953/", "children": []}, {"name": "Data Loss Prevention", "id": "Data Loss Prevention", "path": "/mitigations/M0803/", "children": []}, {"name": "Disable or Remove Feature or Program", "id": "Disable or Remove Feature or Program", "path": "/mitigations/M0942/", "children": []}, {"name": "Encrypt Network Traffic", "id": "Encrypt Network Traffic", "path": "/mitigations/M0808/", "children": []}, {"name": "Encrypt Sensitive Information", "id": "Encrypt Sensitive Information", "path": "/mitigations/M0941/", "children": []}, {"name": "Execution Prevention", "id": "Execution Prevention", "path": "/mitigations/M0938/", "children": []}, {"name": "Exploit Protection", "id": "Exploit Protection", "path": "/mitigations/M0950/", "children": []}, {"name": "Filter Network Traffic", "id": "Filter Network Traffic", "path": "/mitigations/M0937/", "children": []}, {"name": "Human User Authentication", "id": "Human User Authentication", "path": "/mitigations/M0804/", "children": []}, {"name": "Limit Access to Resource Over Network", "id": "Limit Access to Resource Over Network", "path": "/mitigations/M0935/", "children": []}, {"name": "Limit Hardware Installation", "id": "Limit Hardware Installation", "path": "/mitigations/M0934/", "children": []}, {"name": "Mechanical Protection Layers", "id": "Mechanical Protection Layers", "path": "/mitigations/M0805/", "children": []}, {"name": "Minimize Wireless Signal Propagation", "id": "Minimize Wireless Signal Propagation", "path": "/mitigations/M0806/", "children": []}, {"name": "Mitigation Limited or Not Effective", "id": "Mitigation Limited or Not Effective", "path": "/mitigations/M0816/", "children": []}, {"name": "Multi-factor Authentication", "id": "Multi-factor Authentication", "path": "/mitigations/M0932/", "children": []}, {"name": "Network Allowlists", "id": "Network Allowlists", "path": "/mitigations/M0807/", "children": []}, {"name": "Network Intrusion Prevention", "id": "Network Intrusion Prevention", "path": "/mitigations/M0931/", "children": []}, {"name": "Network Segmentation", "id": "Network Segmentation", "path": "/mitigations/M0930/", "children": []}, {"name": "Operating System Configuration", "id": "Operating System Configuration", "path": "/mitigations/M0928/", "children": []}, {"name": "Operational Information Confidentiality", "id": "Operational Information Confidentiality", "path": "/mitigations/M0809/", "children": []}, {"name": "Out-of-Band Communications Channel", "id": "Out-of-Band Communications Channel", "path": "/mitigations/M0810/", "children": []}, {"name": "Password Policies", "id": "Password Policies", "path": "/mitigations/M0927/", "children": []}, {"name": "Privileged Account Management", "id": "Privileged Account Management", "path": "/mitigations/M0926/", "children": []}, {"name": "Redundancy of Service", "id": "Redundancy of Service", "path": "/mitigations/M0811/", "children": []}, {"name": "Restrict File and Directory Permissions", "id": "Restrict File and Directory Permissions", "path": "/mitigations/M0922/", "children": []}, {"name": "Restrict Library Loading", "id": "Restrict Library Loading", "path": "/mitigations/M0944/", "children": []}, {"name": "Restrict Registry Permissions", "id": "Restrict Registry Permissions", "path": "/mitigations/M0924/", "children": []}, {"name": "Restrict Web-Based Content", "id": "Restrict Web-Based Content", "path": "/mitigations/M0921/", "children": []}, {"name": "Safety Instrumented Systems", "id": "Safety Instrumented Systems", "path": "/mitigations/M0812/", "children": []}, {"name": "Software Configuration", "id": "Software Configuration", "path": "/mitigations/M0954/", "children": []}, {"name": "Software Process and Device Authentication", "id": "Software Process and Device Authentication", "path": "/mitigations/M0813/", "children": []}, {"name": "SSL/TLS Inspection", "id": "SSL/TLS Inspection", "path": "/mitigations/M0920/", "children": []}, {"name": "Static Network Configuration", "id": "Static Network Configuration", "path": "/mitigations/M0814/", "children": []}, {"name": "Supply Chain Management", "id": "Supply Chain Management", "path": "/mitigations/M0817/", "children": []}, {"name": "Threat Intelligence Program", "id": "Threat Intelligence Program", "path": "/mitigations/M0919/", "children": []}, {"name": "Update Software", "id": "Update Software", "path": "/mitigations/M0951/", "children": []}, {"name": "User Account Management", "id": "User Account Management", "path": "/mitigations/M0918/", "children": []}, {"name": "User Training", "id": "User Training", "path": "/mitigations/M0917/", "children": []}, {"name": "Validate Program Inputs", "id": "Validate Program Inputs", "path": "/mitigations/M0818/", "children": []}, {"name": "Vulnerability Scanning", "id": "Vulnerability Scanning", "path": "/mitigations/M0916/", "children": []}, {"name": "Watchdog Timers", "id": "Watchdog Timers", "path": "/mitigations/M0815/", "children": []}]}]}, "name": "Restrict Library Loading", "notes": null, "created": "11 June 2019", "modified": "18 December 2024", "descr": "Restricting library loading involves implementing security controls to ensure that only trusted and verified libraries (DLLs, shared objects, etc.) are loaded into processes. Adversaries often abuse Dynamic-Link Library (DLL) Injection, DLL Search Order Hijacking, or LD_PRELOAD mechanisms to execute malicious code by forcing the operating system to load untrusted libraries. This mitigation can be implemented through the following measures: \n\nEnforce Safe Library Loading Practices:\n\n- Enable `SafeDLLSearchMode` on Windows.\n- Restrict `LD_PRELOAD` and `LD_LIBRARY_PATH` usage on Linux systems.\n\nCode Signing Enforcement:\n\n- Require digital signatures for all libraries loaded into processes.\n- Use tools like Signtool, and WDAC to enforce signed DLL execution.\n\nEnvironment Hardening:\n\n- Secure library paths and directories to prevent adversaries from placing rogue libraries.\n- Monitor user-writable directories and system configurations for unauthorized changes.\n\nAudit and Monitor Library Loading:\n\n- Enable `Sysmon` on Windows to monitor for suspicious library loads.\n- Use `auditd` on Linux to monitor shared library paths and configuration file changes.\n\nUse Application Control Solutions:\n\n- Implement AppLocker, WDAC, or SELinux to allow only trusted libraries.\n\n*Tools for Implementation*\n\nWindows-Specific Tools:\n\n- AppLocker: Application whitelisting for DLLs.\n- Windows Defender Application Control (WDAC): Restrict unauthorized library execution.\n- Signtool: Verify and enforce code signing.\n- Sysmon: Monitor DLL load events (Event ID 7).\n\nLinux-Specific Tools:\n\n- auditd: Monitor changes to library paths and critical files.\n- SELinux/AppArmor: Define policies to restrict library loading.\n- ldconfig and chattr: Secure LD configuration files and prevent unauthorized modifications.\n\nCross-Platform Solutions:\n\n- Wazuh or OSSEC: File integrity monitoring for library changes.\n- Tripwire: Detect and alert on unauthorized library modifications.", "version": "1.1", "techniques_addressed_data": [{"domain": "enterprise", "id": "T1547", "name": "Boot or Logon Autostart Execution", "technique_used": false, "subtechniques": [{"technique_used": true, "domain": "enterprise", "id": "008", "name": "LSASS Driver", "descr": "Ensure safe DLL search mode is enabled <code>HKEY_LOCAL_MACHINE\\\\System\\\\CurrentControlSet\\\\Control\\\\Session Manager\\\\SafeDllSearchMode</code> to mitigate risk that lsass.exe loads a malicious code library. (Citation: Microsoft DLL Security)", "subtechniques": [], "color": 1}]}, {"technique_used": true, "domain": "enterprise", "id": "T1574", "name": "Hijack Execution Flow", "descr": "Disallow loading of remote DLLs. This is included by default in Windows Server 2012+ and is available by patch for XP+ and Server 2003+.\n\nEnable Safe DLL Search Mode to force search for system DLLs in directories with greater restrictions (e.g. <code>%SYSTEMROOT%</code>)to be used before local directory DLLs (e.g. a user's home directory)\n\nThe Safe DLL Search Mode can be enabled via Group Policy at Computer Configuration > [Policies] > Administrative Templates > MSS (Legacy): MSS: (SafeDllSearchMode) Enable Safe DLL search mode. The associated Windows Registry key for this is located at <code>HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\SafeDLLSearchMode</code>(Citation: Microsoft More information about DLL)(Citation: Microsoft Dynamic Link Library Search Order)", "subtechniques": [{"technique_used": true, "domain": "enterprise", "id": "001", "name": "DLL", "descr": "Disallow loading of remote DLLs. This is included by default in Windows Server 2012+ and is available by patch for XP+ and Server 2003+.(Citation: Microsoft More information about DLL)\n\nEnable Safe DLL Search Mode to move the user's current folder later in the search order. This is included by default in modern versions of Windows; the associated Windows Registry key is located at <code>HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\SafeDLLSearchMode</code>.(Citation: Microsoft Dynamic Link Library Search Order)", "subtechniques": [], "color": 1}], "color": 1}], "layers": [{"domain": "enterprise", "name": "Enterprise", "filename": "M1044-enterprise-layer.json", "navigator_link": "https://mitre-attack.github.io/attack-navigator/"}], "citations": {"current_number": 0, "Microsoft More information about DLL": {"description": "Microsoft. (2010, August 12). More information about the DLL Preloading remote attack vector. Retrieved December 5, 2014.", "url": "https://msrc-blog.microsoft.com/2010/08/23/more-information-about-the-dll-preloading-remote-attack-vector/", "number": null}, "Microsoft Dynamic Link Library Search Order": {"description": "Microsoft. (2018, May 31). Dynamic-Link Library Search Order. Retrieved November 30, 2014.", "url": "https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order?redirectedfrom=MSDN", "number": null}, "Microsoft DLL Security": {"description": "Microsoft. (n.d.). Dynamic-Link Library Security. Retrieved November 27, 2017.", "url": "https://msdn.microsoft.com/library/windows/desktop/ff919712.aspx", "number": null}}, "versioning_feature": false}